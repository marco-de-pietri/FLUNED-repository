# FLUNED-Repository

This repository includes two tools for the simulation of activated water in fusion installations.

The first one is FLUNED, a tool that allow the mesh-based activation calculation at the component level.

The second one is FLUNED-SL, a tool that allows performing its calculation at the system level in networks piping systems.

More detail on the usage, installation and testing is provided below.

For additional information contact: mdepietri@ind.uned.es

## FLUNED-Repository Installation

For user simplicity and because the two tools can be coupled, the tools are to be installed together.

The recommeded way is to use the installation script present in the _FLUNED-Repository/installation-script/_ folder.

The tools needs to run in a linux environment, the software requirements are OpenFOAM v12 and the packages listed either in the toml file or in the installation script.

The simplest way is to download the script and run it with the following commands:

1. Download
```
wget https://raw.githubusercontent.com/marco-de-pietri/FLUNED-repository/refs/heads/master/installation-script/fluned-repo-install.sh
```

2. Make it executable
```
chmod +x fluned-repo-install.sh
```
3. Source it
```
source fluned-repo-install.sh
```


Users can also check the script and, if required, install it with a different workflow or tooling.

## FLUNED-SL

FLUNED-SL is a tool to calculate and generate a computational model of the
radiation source generated by the flow of an activated fluid through an
arbitrarily complex pipe circuit. The program generate a CDGS source that can be run in the
D1SUNED code and a vtk file for visualization and post-processing. At the moment
it can simulate steady-states and transients and more features are being implemented.

![mcflow output example](/doc/example.png)

### Usage

FLUNED-SL requires a set of files that describe the pipe topology, the radioisotopes entering the circuit and the reaction rates. Examples of the file format describing the circuit can be found in the test folder or generated automatically with a SpaceClaim scripts that can be found in the folder _FLUNED-Repository/spaceclaim-script/_.

Once all the circuit files are ready, an input template for running fluned_sl can be generated with the command:

```
fluned_sl -t
```

Finally, the simulation is run with the command:

```
fluned_sl -i input_file
```
### Tests

the test folder contain a set of tests to check the proper working of the different features.

If the tools have been installed through the installation script, it is recommeded to run the tests in a virtual environment. To do so run the following commands from the FLUNED-repository folder:

1. Generate the virtual environment
```
python3.11 -m venv test_env
```

2. Activate the virtual environment
```
source /test_env/bin/activate
```

3. Install the required packages within the virtual environment
```
pip install ".[test]"
```

4. run the tests
```
python -m pytest -v
```

5. exit the virtual environment
```
deactivate
```

## FLUNED

FLUNED is a mesh-based tool for the simulation of the transport within water of radio-isotope generated by nuclear fusion neutrons.

The tool takes as input a finished hydro-dynamic simulation performed with the code ANSYS FLUENT or OpenFOAM and creates a passive scalar simulation of the radio-isotope concentration.

For simulating cases of irradiated fluid, the information relative to the radio-isotope generation can be provided through a vtk file or by providing a uniform, constant value.

The physics implemented is rather simple and has some limitations however it has been positively validated for water studies with the experimental neutron and photon data generated in the FNG water activaton experiment run in 2019 (_angeloneMeasurementDelayedNeutron2020_ [1], _nobsComputationalEvaluationN162020_ [2])

A paper describing its development and validation can be found in [3]

[1]doi: 10.1016/j.fusengdes.2020.111998\
[2]doi: 10.1016/j.fusengdes.2020.111743\
[3]doi: 10.1016/j.cpc.2023.108807

## Usage

The pre/post-processor scripts and the solver are designed to simplify the user simulation process. From the command line in the folder where the Ansys - FLUENT or OpenFOAM files are located the following workflow is recommended.

 1.	Generate the FLUNED input:

 ```
 fluned -t
 ```

 2.	Modify the input_template file with the appropriate parameters. The file will contain the default values together with the available options.

 3.	Launch the FLUNED pre-processor:

 ```
 fluned -i input-file
 ```

This will create a folder named as the FLUNED case reported in the input file. The created simulation files follow the OpenFOAM structure, therefore some additional tweaking in the simulation parameters can be done if the user has some previous knowledge of the OpenFOAM code. Thanks to the modularity of the OpenFOAM classes, FLUNED simulations can be natively run in parallel using the appropriate OpenFOAM commands.

4.	In the FLUNED case folder launch the solver by running:

```
FLUNED-solver
```

5.	Once the simulation is finished, the post-processor can be launched in the simulation folder by running:

```
flunedPost
```

## Tests

A set of tests are present in the tests folder. These cases are very simple and have no physical accuracy, are just meant to test the integrated working of the scripts functionalities.
To run these execute the following commands from a bash shell inside the tests folder called _FLUNED-Repository/tests-integration_

1. Run the test suite.

```
./run_tests.sh
```

2. Run the post processing script for the tests simulations:

```
./run_post.sh
```

3. Run a script that executes the comparison between the test results and the expected results. This comparison will be written in the _test_results_ file
```
./eval_results.sh
```

4. Clean the created files
```
./clean_tests.sh
```

## LICENSE
All the code present in the FLUNED-Repository is open-source software licensed under the [GNU GPLv3](./LICENSE) license.
